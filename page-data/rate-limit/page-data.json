{"componentChunkName":"component---src-templates-post-jsx","path":"/rate-limit/","result":{"data":{"site":{"siteMetadata":{"title":"Seongjun Kim Blog"}},"markdownRemark":{"id":"1661f2df-49ed-52ff-a108-89ffa05b6889","excerpt":"처리율 제한 장치(rate limiter)란? 클라이언트 또는 서비스가 보내는 트래픽의 처리율을 제어하기 위한 장치이다. 특정 기간 내에 전송되는 클라이언트의 요청 횟수를 제한한다. 요청 횟수가 임계치(threshold)를 넘어서면 추가로 도달한 모든 호출은 처리가 중단(block)된다. 오픈 API나 외부에 특정 API를 제공하는 서비스의 경우 시간당 …","html":"<h2>처리율 제한 장치(rate limiter)란?</h2>\n<ul>\n<li>클라이언트 또는 서비스가 보내는 트래픽의 처리율을 제어하기 위한 장치이다.</li>\n<li>특정 기간 내에 전송되는 클라이언트의 요청 횟수를 제한한다.</li>\n<li>요청 횟수가 임계치(threshold)를 넘어서면 추가로 도달한 모든 호출은 처리가 중단(block)된다.</li>\n<li>오픈 API나 외부에 특정 API를 제공하는 서비스의 경우 시간당 몇 회 호출이나 하루에 몇 회 호출 등의 제한을 걸어두곤 한다.</li>\n</ul>\n<h2>왜 처리율 제한이 필요한가??</h2>\n<ul>\n<li>DoS(Denial of Service) 공격에 의한 자원 고갈을 방지할 수 있다. 과한 트래픽으로 부터 서비스를 보호한다.</li>\n<li>비용을 절감한다. 추가 요청에 대한 처리를 제한하면 서버를 많이 두지 않아도 되고, 우선순위가 높은 API에 더 많은 자원을 할당할 수 있다.</li>\n<li>초과하는 횟수에 따라 과금하는 비즈니스 모델로 활용이 가능하다.</li>\n<li>서버 과부하를 막는다. 봇애서 오는 트래픽이나 사용자의 잘못된 이용 패턴으로 유발된 트래픽을 걸러내는데 사용 가능</li>\n</ul>\n<h2>처리율 제한 장치의 위치</h2>\n<h3>서버에서의 처리율 제한</h3>\n<ul>\n<li>처리하고자 하는 조건에 따라 서버측에서 제한을 건다.</li>\n</ul>\n<h3>미들웨어에서의 처리율 제한</h3>\n<ul>\n<li>미들웨어에서 API 서버로 가는 요청을 통제한다.</li>\n<li>요청이 너무 많이오면 429 code (Too many requests)를 리턴해준다.\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/333dc2330da8567438164c222d2c4c3f/3b5a6/2022-01-28-01-14-01.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 38.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaUlEQVQoz32RyU4CQRRF+QQXLpCZ7q6i6W6aQcQQwQiiICYyKA4xIGpiBJSt7ogfYIy4wR1+Av7g9XURmSQuXmp6Oe/eWzaJBSFxKjZfSkCD0yvjqFRFNpeH26dA5hr8TJ3v5TNFZ9sUoIMHDcgEsvZMNWB3enHVvEWpcgyH2z+5t1arb1GEALpIxV6hiK/hEJ+DAeKJJGRSoZsxAak3rgl4gpVVO9qdR3yPRqjXm/BKHEEjTBB1zqFQyFQdN3f3aD0/wVhPY6t4Cs0wwYIhgnRxdnGJgGYivZPFbr6MbKUhINbdYmQTy9GNJOKZLHgoBi2ZhqqHwUlFu9VBtXYuenQzQsMjMHMFcBpoAf3LFRpglItCoftkjmq1hte3d/R6L+j3P7B/cCjsW4CAFgIjiLVXyNmfDGcP4heVcX6JZApaKIrOQxdlytDhkcT72OLyD/kD/IX65IAIfc3lQ2o7g02KwCOxKfCf+gHAJ/2Bn7+NJgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2022 01 28 01 14 01' title='2022 01 28 01 14 01' src='/static/333dc2330da8567438164c222d2c4c3f/ca1dc/2022-01-28-01-14-01.png' srcset='/static/333dc2330da8567438164c222d2c4c3f/e7570/2022-01-28-01-14-01.png 170w,\n/static/333dc2330da8567438164c222d2c4c3f/f46e7/2022-01-28-01-14-01.png 340w,\n/static/333dc2330da8567438164c222d2c4c3f/ca1dc/2022-01-28-01-14-01.png 680w,\n/static/333dc2330da8567438164c222d2c4c3f/02d09/2022-01-28-01-14-01.png 1020w,\n/static/333dc2330da8567438164c222d2c4c3f/3b5a6/2022-01-28-01-14-01.png 1302w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy'>\n  </a>\n    </span></li>\n</ul>\n<h3>클라이언트에서의 처리율 제한 장치</h3>\n<ul>\n<li>클라이언트의 요청은 쉽게 위변조가 가능해서 안정적으로 처리율 제한을 걸 수 없다.</li>\n<li>하지만 꼭 클라이언트가 어플이나 브라우저가 아닌 서버일 수 있음 (소비자)</li>\n<li>\n<p>제공자는 그냥 거절하면 그만이지만 클라이언트에서는 다양한 방법을 사용 가능</p>\n<ul>\n<li>다시 요청할 수 있을 때까지 대기</li>\n<li>일정 시간 기다린 후 그때도 통과를 못한다면 타임아웃 처리</li>\n<li>요청 취소</li>\n</ul>\n</li>\n</ul>\n<h2>처리율 제한 알고리즘</h2>\n<h3>1. Token Bucket</h3>\n<ul>\n<li>토큰 버킷은 지정된 용량을 갖는 컨테이너이고, 이 버킷에는 설정된 양의 토큰이 주기적으로 채워진다.</li>\n<li>토큰이 꽉 차있으면 더 이상 토큰은 추가되지 않는다.</li>\n<li>\n<p>요청이 들어오면 버킷에 토큰이 있는지 확인한다.</p>\n<ul>\n<li>충분한 토큰이 있으면 하나의 토큰을 버리고 요청을 처리한다.</li>\n<li>토큰이 없으면 요청은 버려진다.</li>\n</ul>\n</li>\n</ul>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 527px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/1cc7996c1013ac315d00112420a7f797/c6c03/2022-01-28-01-53-33.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 57.05882352941176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABe0lEQVQoz4WS207CQBCG+zy+jYm+iC+gMfEBvPPGhFuvjDGBaAViYqBCQSDQMwtt6YGlLQotWNhu3VJCQDH8F5vM4ZvM7AwV72q5XEA44oWarLQd6EQIxThRvE/UH0+SZ/QeXKuSGDiK/9dvGEdRGGM13xJzbJ9ueq8ipNvf7nQVwwfg+Wze14R3unB9eXFzfrUMwkG27rDdVd0DcNJkV7yrlU/rzIlhlohpa892P5+OQLRYLDZfsANjjMhrDj4K90dvT8ef4wkxg8DnBY7n+XanI0qSbdmE3wsnJUmsxWaBUk6dCCFd04AiizyvKLJt28SzhvGqm9U68HA4dF13NguWKA7DaPrl+qNena0wVZazRjXVNB2PLI8ozad839d1nTAAAI7jZFmWJKkHFNBXG+UXJnPWYIqPdDFTat1WhFy1CS1T03RVVcfjMbXdMITQsqzUdBwHgO4s8JPLQUiDDrDhJAjWl7A9cxiGJNswDM/zNrXWC4iSufYeyQ88GWomdNw9wgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2022 01 28 01 53 33' title='2022 01 28 01 53 33' src='/static/1cc7996c1013ac315d00112420a7f797/c6c03/2022-01-28-01-53-33.png' srcset='/static/1cc7996c1013ac315d00112420a7f797/e7570/2022-01-28-01-53-33.png 170w,\n/static/1cc7996c1013ac315d00112420a7f797/f46e7/2022-01-28-01-53-33.png 340w,\n/static/1cc7996c1013ac315d00112420a7f797/c6c03/2022-01-28-01-53-33.png 527w' sizes='(max-width: 527px) 100vw, 527px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy'>\n  </a>\n    </span></p>\n<ul>\n<li>가장 간단하고 보편적으로 쓰인다.</li>\n<li>\n<p>통상적으로 엔드포인트마다 별도의 버킷을 둔다.</p>\n<ul>\n<li>IP별로 처리율을 제한하고 싶다면 IP주소마다 버킷을 하나씩 할당한다.</li>\n<li>시스템의 처리율을 제한하고 싶다면 모든 요청이 하나의 버킷을 공유하도록 한다.</li>\n</ul>\n</li>\n<li>버킷의 크기, 토큰 공급률을 인자로 받는다</li>\n</ul>\n<h4>장점</h4>\n<ul>\n<li>구현이 쉽다.</li>\n<li>메모리 사용 측면에서도 효율적이다.</li>\n<li>짧은 시간에 집중되는 트래픽도 처리 가능하다. 버킷에 남은 토큰이 있기만 하면 요청은 시스템에 전달된다.</li>\n</ul>\n<h4>단점</h4>\n<ul>\n<li>버킷의 크기와 토큰 공급률이라는 인자를 적절하게 튜닝하는게 까다롭다.</li>\n</ul>\n<h3>2. Leaky Bucket</h3>\n<ul>\n<li>요청이 도착하면 큐가 가득 차 있는지 본다. 빈 자리가 있는 경우에는 큐에 요청을 추가한다.</li>\n<li>큐가 가득 차 있는 경우에는 새 요청은 버린다.</li>\n<li>지정된 시간마다 큐에서 요청을 꺼내어 처리한다.</li>\n</ul>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 573px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/c976af7710e154f9f8207106653cc4a2/f5c00/2022-01-28-02-35-24.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACP0lEQVQoz11Sy27TUBDNH/R3yi8gIVYsUNUIqoAQK1giJMprgRASCJZlhfIBCLWblkoWhKICpWpIaWw3jWOTxI1fiR3f3PdwbSdp4Ui+Gs3MmTnjmZKUEgBqtZppmsqQ/yLzJPHpqRPaR9Lt/RcqqS9N04WFhUqlomxKKcwhpQAJI3xrfeXSxkXgwCVXNJ4jIwdB4DhOtVrVNE3Zg8EgjuMwDKMcTHCgUN5cWty4oLK54EXPAiXV1vM8VQljrDhuv9/tdnVdb7VOLKtNBYMJXF2/svghIwsQnJGoezyOBlPZhVopBOFiOMFwDipbqb1fu7eslYGpQcBw9eX3l599Ws3I8+mzEkJGhM/mzf15hHrDgWl3GvWeqZ/8qjumgfo94HzWWdCUjSOStONIGQlLmBKcdcrYKE1a7Vbr+PiP49i2bZoGY3QqO8CBj33EUULTEUnHNEUMediLSFSURgOXUlbImY4jxJQcktAYGVRgCUwCUS8SE3NkzsmxbcUo04IZJoISEEzmqyqEuch/V99/tV17o+283K69/qx5k3DeCvk+JbP9KwdSBzA7kiJj79Re+/7z7d7B2o/9Hcs4+2cAfr/zfPfF6teHj3efPtl59GDz7qHbOFvV9BJBeBRJyC5BLY8QtbtMXhC6dz7evqFdu7lZXtkqX99a+mZ9OSMXYEIGWAjOm82jo2azXj8YjuK8NGB3jDpRYvlJJ5xYvsw3WhqfQ5Ik2TNO0AxpOg05brehHzbbht42G8bvaDRUp/kXPe3/axeybU4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2022 01 28 02 35 24' title='2022 01 28 02 35 24' src='/static/c976af7710e154f9f8207106653cc4a2/f5c00/2022-01-28-02-35-24.png' srcset='/static/c976af7710e154f9f8207106653cc4a2/e7570/2022-01-28-02-35-24.png 170w,\n/static/c976af7710e154f9f8207106653cc4a2/f46e7/2022-01-28-02-35-24.png 340w,\n/static/c976af7710e154f9f8207106653cc4a2/f5c00/2022-01-28-02-35-24.png 573w' sizes='(max-width: 573px) 100vw, 573px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy'>\n  </a>\n    </span></p>\n<ul>\n<li>토큰 버킷 알고리즘과 비슷하지만 요청 처리율이 고정되어있다.</li>\n<li>보통 FIFO로 구현한다.</li>\n<li>버킷 크기, 처리율을 인자로 받는다.</li>\n</ul>\n<h4>장점</h4>\n<ul>\n<li>큐의 크기가 제한되어 있어 사용량 측면에서 효율적이다.</li>\n<li>고정된 처리율을 갖고 있으므로 안정적인 출력이 가능하다.</li>\n</ul>\n<h4>단점</h4>\n<ul>\n<li>단시간에 많은 트래픽이 몰리는 경우 큐에는 오래된 요청들이 쌓이게 되고, 그 요청들을 제때 처리 못하면 최신 요청들이 버려진다.</li>\n<li>버킷 크기, 처리율을 튜닝하기 까다롭다.</li>\n</ul>\n<h3>3. Fixed Window Counter</h3>\n<ul>\n<li>타임라인을 고정된 간격의 window로 나누고 각 window마다 counter 를 붙인다.</li>\n<li>요청이 접수될 때마다 이 counter값은 1씩 증가한다.</li>\n<li>이 counter 값이 threshold 에 도달하면 새로운 요청은 새 윈도가 열릴 때까지 버려진다.</li>\n</ul>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/dba47f04028679510399b1455fbdd827/0ea77/2022-01-28-03-00-13.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 43.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLElEQVQoz42SwU6EMBCGeUpfwLNPsWdvPoEnE5/BaOJBjYeNXjSc3C0babelsMBCS+G3BdkAi1kn/ClM04+Zf+rBRtM06NeD3DdOR3+2D++vDZQlmuUbTByDS4nYSlqlaQrOOZIkQV3XR2e9YcIYA601dG1gshx4tUARYROGCIIAlNIWSghBaHMngaWtKrEV5bsMK7bB4uUa74GPiHEwxlqgk6uwKIqRVWOgc6t7YJrur9syxsXTFT7lGhHlIAFpoa5Vp6HnRx7Wv5Bn+oHzx0tIlWK7j3F2v8CS+eAbihVZH1oWQmA6zAmwS3ztQtz4d8h0gdzq1n9AmAmofdEOw7WplGo1O8iph7pUkN8cynppqgoJFaiU/td1mQW6tW/fvTs/nb+j+znwbQ76A0o0uhLEjHqxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2022 01 28 03 00 13' title='2022 01 28 03 00 13' src='/static/dba47f04028679510399b1455fbdd827/ca1dc/2022-01-28-03-00-13.png' srcset='/static/dba47f04028679510399b1455fbdd827/e7570/2022-01-28-03-00-13.png 170w,\n/static/dba47f04028679510399b1455fbdd827/f46e7/2022-01-28-03-00-13.png 340w,\n/static/dba47f04028679510399b1455fbdd827/ca1dc/2022-01-28-03-00-13.png 680w,\n/static/dba47f04028679510399b1455fbdd827/0ea77/2022-01-28-03-00-13.png 682w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy'>\n  </a>\n    </span>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/c10fe531c043135f1ef95137823d76c4/aa4b8/2022-01-29-22-12-32.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 72.35294117647058%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvklEQVQ4y5WTCXObMBCF8///V2Z6ZOI4TpzxUdvBF2CMACFxCb4Kh7Q+UifdGSENe2jf09sbOmua5rBXZYlar8iWS7S3gGKLThzcaIOXuKwDwV427CJNXdcnua3dHBc8/LZB8umR+McdpfMAqk8e9xn7L4zsmniCqVezDqs/hf5dsHNImRKke9orjmI5R3N+vijYWtlClpJUx2glrcOQ55q8yClNSaosVBuqdWbBmOsdHhBXFbLfI/n2nXz2E9J7VHjHcDtg6D7xvNoxdmsWfm5zrnDIEeRs5xPO51TSty0HmCIgygRCh8S6IFI1Km+OqLoCud3be0WhEKV66/qUwW6vP3+UA4dFQWplU26sXLzXg2xU7OBFW3zpsd6FhGmDLxTGmK/JJh302d/eUix7Fv8juegx8p55sWvshoy3hpWVzXu3H3N45ijt4yjfp47Ehaz+SzYtjJaz9v5k4WA23huHHZFNJ5XaVJ9PyvvoJdMJajRCuxPKbEYSDHH2cxzxyswN2IqGTaC+OHpWW3o8Iu49kC8H6ODejt6Q+X7Kr2DCIoiZ7wxubC6oOC3YfU95rK3mJJmdkA8G8Cj2b85vRfRDQ9t6VTsAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2022 01 29 22 12 32' title='2022 01 29 22 12 32' src='/static/c10fe531c043135f1ef95137823d76c4/ca1dc/2022-01-29-22-12-32.png' srcset='/static/c10fe531c043135f1ef95137823d76c4/e7570/2022-01-29-22-12-32.png 170w,\n/static/c10fe531c043135f1ef95137823d76c4/f46e7/2022-01-29-22-12-32.png 340w,\n/static/c10fe531c043135f1ef95137823d76c4/ca1dc/2022-01-29-22-12-32.png 680w,\n/static/c10fe531c043135f1ef95137823d76c4/aa4b8/2022-01-29-22-12-32.png 995w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy'>\n  </a>\n    </span></p>\n<ul>\n<li>매 초마다 할당량 이상이 오면 초과분은 버려진다.</li>\n<li>이 알고리즘의 가장 큰 문제는 경계 시간대에 몰리면 window에 할당된 양보다 더 많은 요청이 처리될 수 있다.</li>\n</ul>\n<h4>장점</h4>\n<ul>\n<li>메모리 효율이 좋다.</li>\n<li>이해하기 쉽다.</li>\n<li>window가 닫히는 시점에 카운터를 초기화하는 방식은 특정한 트래픽 패턴을 처리하기에 적합하다.</li>\n</ul>\n<h4>단점</h4>\n<ul>\n<li>경계에서 일시적으로 많은 트래픽이 몰리는 경우 기대했던 시스템의 처리 한도보다 많은 양의 요청을 처리해야한다.</li>\n</ul>\n<h3>4. Sliding Window Log</h3>\n<ul>\n<li>요청의 타임스탬프를 레디스의 sorted set같은 캐시에 보관한다.</li>\n<li>\n<p>새 요청이 오면 만료된 타임스탬프는 제거한다.</p>\n<ul>\n<li>만료된 타임스탬프는 그 값이 현재 윈도의 시작 시점보다 오래된 타임스탬프를 말한다.</li>\n</ul>\n</li>\n<li>새 요청의 타임스탬프를 로그에 추가한다.</li>\n<li>로그의 크기가 허용치보다 같거나 작으면 요청을 시스템에 전달한다. 그렇지 않은 경우에는 처리를 거부한다.</li>\n</ul>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/d9f10adf306f051c11bde8d24bd2f0b7/95234/2022-01-29-22-14-39.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 26.47058823529412%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAtUlEQVQY03VQWw7EIAjs/a/ZfmwTW9/aKjoLJt10X5MQwgjjwARG7x2fuLhSCpxzsNbiOA786r/X01VIbtRgjIH3fnA5Z2itQUSgWrHv++AEj3XFsixorb2JvgQrVWxmQwgBOSXEFGGsGc6Ih4jbRDzxm8AqBcWC9E9Qci55ZAkdNHz0kOfMjvU8I7K7k9dOOcHzR4Hjy+G96K2j8moSwo1VeaCySOU7knCVoJwaoiffV3ruGk9+/og/7URqcgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2022 01 29 22 14 39' title='2022 01 29 22 14 39' src='/static/d9f10adf306f051c11bde8d24bd2f0b7/ca1dc/2022-01-29-22-14-39.png' srcset='/static/d9f10adf306f051c11bde8d24bd2f0b7/e7570/2022-01-29-22-14-39.png 170w,\n/static/d9f10adf306f051c11bde8d24bd2f0b7/f46e7/2022-01-29-22-14-39.png 340w,\n/static/d9f10adf306f051c11bde8d24bd2f0b7/ca1dc/2022-01-29-22-14-39.png 680w,\n/static/d9f10adf306f051c11bde8d24bd2f0b7/02d09/2022-01-29-22-14-39.png 1020w,\n/static/d9f10adf306f051c11bde8d24bd2f0b7/95234/2022-01-29-22-14-39.png 1079w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy'>\n  </a>\n    </span></p>\n<ul>\n<li>3의 경계에 편향한 트래픽에서의 문제를 대응하기 위한 알고리즘이다.</li>\n</ul>\n<h4>장점</h4>\n<ul>\n<li>어느 순간의 윈도를 보더라도 허용되는 요청의 개수는 시스템의 처리율 한도를 넘지 않는다.</li>\n</ul>\n<h4>단점</h4>\n<ul>\n<li>각 요청에 대한 타임스탬프를 보관하기 때문에 메모리를 많이 사용한다.</li>\n</ul>\n<h3>5. Sliding Window Counters</h3>\n<ul>\n<li>현재 윈도에서의 요청 수 + 직전 윈도에서의 요청 수 * 이동 윈도와 겹치는 비율</li>\n</ul>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/fba85e1e8786931e8c5ae6b4c40eb41e/78d47/2022-01-30-00-05-46.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 34.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuElEQVQoz5VRQQ6CMBD0/6/SBOPBhMSDB0kkHkgRPCi0hTZtdyxGoKIkMkmz7ezsdNtdIQARDfFjdaRzoMd9PL9zU6ymRCiioEgLgVsU/dTNGoYdSikHvmlaKG2gfVr6vbV21vTLsBeVVYGEnXAuU2T5EXVxgKkTKJ7BBRf/bXitc+ySLfaXGKyMIdkGnK19u+lotsTQOQshOYwz4KKCakXHgjy/aCig8Smt/y9j7Csqrfv07EA6PAGxgCbiZj0MHwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2022 01 30 00 05 46' title='2022 01 30 00 05 46' src='/static/fba85e1e8786931e8c5ae6b4c40eb41e/ca1dc/2022-01-30-00-05-46.png' srcset='/static/fba85e1e8786931e8c5ae6b4c40eb41e/e7570/2022-01-30-00-05-46.png 170w,\n/static/fba85e1e8786931e8c5ae6b4c40eb41e/f46e7/2022-01-30-00-05-46.png 340w,\n/static/fba85e1e8786931e8c5ae6b4c40eb41e/ca1dc/2022-01-30-00-05-46.png 680w,\n/static/fba85e1e8786931e8c5ae6b4c40eb41e/78d47/2022-01-30-00-05-46.png 800w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy'>\n  </a>\n    </span></p>\n<ul>\n<li>고정 윈도 카운터 알고리즘과 슬라이딩 윈도를 결합한 알고리즘</li>\n</ul>\n<h4>장점</h4>\n<ul>\n<li>이전 시간대의 평균 처리율에 따라 현재 윈도의 상태를 계산하므로 짧은 시간에 몰리는 트래픽에도 잘 대응한다.</li>\n<li>메모리 효율이 좋다.</li>\n</ul>\n<h4>단점</h4>\n<ul>\n<li>직전시간대에 도착한 요청이 균등하게 분포되어 있다고 가정한 상태에서 추정치를 계산하므로 다소 느슨하다.</li>\n<li>하지만 그렇게 심각한 문제는 아님</li>\n</ul>\n<h2>Redis를 이용한 구현 생각해보기</h2>\n<ul>\n<li>특정 기간에 n회 라는 제한</li>\n<li>\n<p>api가 여러개라면 api의 종류를 key로 넣는다.</p>\n<ul>\n<li>api:posts</li>\n</ul>\n</li>\n<li>\n<p>유저별로 개수를 제한한다면 user id 를 넣는다.</p>\n<ul>\n<li>api:posts:123 </li>\n</ul>\n</li>\n<li>\n<p>특정 기간의정보. </p>\n<ul>\n<li>윈도를 어떻게 설정할 것이냐에 따라 키가 달라짐</li>\n</ul>\n</li>\n<li>\n<p>5분마다 n회라면?</p>\n<ul>\n<li>api:posts:123:202201271005</li>\n<li>api:posts:123:202201271010</li>\n<li>api:posts:123:202201271015</li>\n</ul>\n</li>\n<li>value 는 호출 수</li>\n</ul>\n<h2>References</h2>\n<ul>\n<li><a href=\"https://engineering.linecorp.com/ko/blog/high-throughput-distributed-rate-limiter/\">https://engineering.linecorp.com/ko/blog/high-throughput-distributed-rate-limiter/</a></li>\n<li><a href=\"https://dev.to/swyx/networking-essentials-rate-limiting-and-traffic-shaping-43ii\">https://dev.to/swyx/networking-essentials-rate-limiting-and-traffic-shaping-43ii</a></li>\n<li><a href=\"https://hechao.li/2018/06/25/Rate-Limiter-Part1/\">https://hechao.li/2018/06/25/Rate-Limiter-Part1/</a></li>\n</ul>","frontmatter":{"title":"처리율 제한 Rate Limit","date":"January 27, 2022","update":"January 27, 2022","tags":["redis","backend"],"series":null},"fields":{"slug":"/rate-limit/","readingTime":{"minutes":3.88}}},"seriesList":{"edges":[{"node":{"id":"15b51d30-c078-53de-a25e-48039f097339","fields":{"slug":"/3-mount/"},"frontmatter":{"title":"Ubuntu 에서 (외장) 하드디스크 사용하기 "}}},{"node":{"id":"ae390cb5-0f32-5525-9ffc-204ebb1321a2","fields":{"slug":"/4-pgconnectbad/"},"frontmatter":{"title":"PG:ConnectionBad - could not connect to server: Connection refused"}}},{"node":{"id":"ecda0f77-0b85-5ca7-b7e1-02b52c277c4d","fields":{"slug":"/23-InfraStructureAsCode/"},"frontmatter":{"title":"Infrastructure as code"}}},{"node":{"id":"0106d6fa-95ca-57ce-b105-a61ccc1bfe48","fields":{"slug":"/26-difference-between-binary-semaphore-and-mutex/"},"frontmatter":{"title":"Binary Semaphore vs Mutex"}}},{"node":{"id":"9b992cd0-63e6-58c6-9932-8635b1c6296f","fields":{"slug":"/sudo-with-touch-id/"},"frontmatter":{"title":"터미널에서 비밀번호 말고 touch id로 sudo 쓰기"}}},{"node":{"id":"8dfb02e2-4517-5ee9-8a31-a3558811607e","fields":{"slug":"/gh-pages-cname/"},"frontmatter":{"title":"gh-pages, custom domain(cname) 적용 안 될 때 (gatsby-gh-pages-action)"}}},{"node":{"id":"471fd508-4593-5513-aaed-79bff70247a9","fields":{"slug":"/op-ssh/"},"frontmatter":{"title":"1password + ssh key password"}}},{"node":{"id":"e310aca0-ac3a-5c50-a84e-cacf6da37a52","fields":{"slug":"/https-and-ssl/"},"frontmatter":{"title":"HTTPS 와 SSL"}}},{"node":{"id":"dd1d3e00-4e08-55dc-9e58-b09bb83c5961","fields":{"slug":"/https-and-ssl-2/"},"frontmatter":{"title":"HTTPS 와 SSL - 2"}}},{"node":{"id":"75217705-7603-5d83-8492-2112ee48b14b","fields":{"slug":"/single-point-of-failure/"},"frontmatter":{"title":"단일 장애 지점(SPOF)이란? Single Point of Failure"}}},{"node":{"id":"1661f2df-49ed-52ff-a108-89ffa05b6889","fields":{"slug":"/rate-limit/"},"frontmatter":{"title":"처리율 제한 Rate Limit"}}}]},"previous":{"fields":{"slug":"/single-point-of-failure/"},"frontmatter":{"title":"단일 장애 지점(SPOF)이란? Single Point of Failure"}},"next":null},"pageContext":{"id":"1661f2df-49ed-52ff-a108-89ffa05b6889","series":null,"previousPostId":"75217705-7603-5d83-8492-2112ee48b14b","nextPostId":null}},"staticQueryHashes":[]}